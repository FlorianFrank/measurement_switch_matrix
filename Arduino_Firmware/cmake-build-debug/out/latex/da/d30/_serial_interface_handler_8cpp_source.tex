\hypertarget{_serial_interface_handler_8cpp_source}{}\doxysection{Serial\+Interface\+Handler.\+cpp}
\label{_serial_interface_handler_8cpp_source}\index{/home/florianfrank/Documents/Research/Projects/NanoSec/measurement\_switch\_matrix/nanosec\_crossbar\_controller/Arduino\_Firmware/Src/SerialInterfaceHandler.cpp@{/home/florianfrank/Documents/Research/Projects/NanoSec/measurement\_switch\_matrix/nanosec\_crossbar\_controller/Arduino\_Firmware/Src/SerialInterfaceHandler.cpp}}
\mbox{\hyperlink{_serial_interface_handler_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00001}00001 \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00002}00002 \textcolor{comment}{// Created by florianfrank on 02.11.21.}}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00003}00003 \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00004}00004 }
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00005}00005 \textcolor{preprocessor}{\#include "{}../Include/SerialInterfaceHandler.h"{}}}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00006}00006 \textcolor{preprocessor}{\#include "{}Arduino.h"{}}}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00007}00007 }
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00008}\mbox{\hyperlink{class_serial_interface_handler_ab48b55dd39975572cfba59dd9d1db902}{00008}} \mbox{\hyperlink{class_serial_interface_handler_ab48b55dd39975572cfba59dd9d1db902}{SerialInterfaceHandler::SerialInterfaceHandler}}(uint16\_t baudRate): m\_Baudrate(baudRate), m\_IsSerialInterfaceOpen(false)}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00009}00009 \{}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00010}00010     \mbox{\hyperlink{class_serial_interface_handler_a1d383b9324fb96efc3c9f17e12de5886}{InitializeSerialInterface}}(); \textcolor{comment}{// TODO think about error handling}}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00011}00011 \}}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00012}00012 }
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00013}\mbox{\hyperlink{class_serial_interface_handler_a8af7296a4da1fd8202281c5e222f03b1}{00013}} \mbox{\hyperlink{class_serial_interface_handler_a8af7296a4da1fd8202281c5e222f03b1}{SerialInterfaceHandler::\string~SerialInterfaceHandler}}()}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00014}00014 \{}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00015}00015     \mbox{\hyperlink{class_serial_interface_handler_ae895855e260a7abab0014000d6e7b6e4}{m\_IsSerialInterfaceOpen}} = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00016}00016 \}}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00017}00017 }
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00018}\mbox{\hyperlink{class_serial_interface_handler_a1d383b9324fb96efc3c9f17e12de5886}{00018}} \mbox{\hyperlink{_error_codes_8h_a59e56af19e754a6aa26a612ebf91d05f}{ErrorCode}} \mbox{\hyperlink{class_serial_interface_handler_a1d383b9324fb96efc3c9f17e12de5886}{SerialInterfaceHandler::InitializeSerialInterface}}()}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00019}00019 \{}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00020}00020     Serial.begin(\mbox{\hyperlink{class_serial_interface_handler_a25bbdc8cef06c716072622690b82ff21}{m\_Baudrate}});}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00021}00021     \textcolor{keywordflow}{while}(!Serial)}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00022}00022     \{}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00023}00023         \textcolor{comment}{// TODO implement timeout and error handling}}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00024}00024     \}}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00025}00025 }
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00026}00026     \mbox{\hyperlink{class_serial_interface_handler_ae895855e260a7abab0014000d6e7b6e4}{m\_IsSerialInterfaceOpen}} = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00027}00027 }
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00028}00028     \textcolor{keywordflow}{return} \mbox{\hyperlink{_error_codes_8h_a59e56af19e754a6aa26a612ebf91d05fabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR}};}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00029}00029 \}}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00030}00030 }
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00031}\mbox{\hyperlink{class_serial_interface_handler_a504c6be2047cd588c63f91a0798859e7}{00031}} \mbox{\hyperlink{_error_codes_8h_a59e56af19e754a6aa26a612ebf91d05f}{ErrorCode}} \mbox{\hyperlink{class_serial_interface_handler_a504c6be2047cd588c63f91a0798859e7}{SerialInterfaceHandler::DeInitializeSerialInterface}}()}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00032}00032 \{}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00033}00033     \textcolor{keywordflow}{return} \mbox{\hyperlink{_error_codes_8h_a59e56af19e754a6aa26a612ebf91d05fa9150b687e9c52039a4bd5ea5ae2e0fe9}{INVALID\_LENGTH}};}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00034}00034 \}}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00035}00035 }
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00036}\mbox{\hyperlink{class_serial_interface_handler_a7a42dfe707724421c7de536f7fad4343}{00036}} \textcolor{comment}{/*static*/} \mbox{\hyperlink{_error_codes_8h_a59e56af19e754a6aa26a612ebf91d05f}{ErrorCode}} \mbox{\hyperlink{class_serial_interface_handler_a7a42dfe707724421c7de536f7fad4343}{SerialInterfaceHandler::WriteMessage}}(\mbox{\hyperlink{class_message}{Message}} \&message)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00037}00037 \textcolor{keyword}{}\{}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00038}00038     \textcolor{keywordflow}{if}(!\mbox{\hyperlink{class_serial_interface_handler_ae895855e260a7abab0014000d6e7b6e4}{m\_IsSerialInterfaceOpen}})}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00039}00039         \textcolor{keywordflow}{return} \mbox{\hyperlink{_error_codes_8h_a59e56af19e754a6aa26a612ebf91d05fa56dbaa6d138028010046221ba5d4c516}{INTERFACE\_CLOSED}};}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00040}00040 }
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00041}00041     \textcolor{keywordtype}{char} sendBuffer[\mbox{\hyperlink{_serial_interface_handler_8h_ab356f5b267384a4c77c9b0e0c73683b4}{MAX\_LEN\_SEND\_BUFFER}}];}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00042}00042     \textcolor{keywordtype}{int} len = \mbox{\hyperlink{_serial_interface_handler_8h_ab356f5b267384a4c77c9b0e0c73683b4}{MAX\_LEN\_SEND\_BUFFER}};}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00043}00043     \mbox{\hyperlink{class_message_adccaa256da501f1c74ef7aaa5decd74e}{Message::MessageToCharArray}}(message, sendBuffer, \&len);}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00044}00044     \textcolor{keywordflow}{if}(Serial.write(sendBuffer) != message.\mbox{\hyperlink{class_message_a6f6140c197f1cda7a751a9985aa1027d}{GetSize}}())}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00045}00045     \{}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00046}00046         \textcolor{keywordflow}{return} \mbox{\hyperlink{_error_codes_8h_a59e56af19e754a6aa26a612ebf91d05fa9150b687e9c52039a4bd5ea5ae2e0fe9}{INVALID\_LENGTH}};}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00047}00047     \}}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00048}00048 }
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00049}00049     \textcolor{keywordflow}{return} \mbox{\hyperlink{_error_codes_8h_a59e56af19e754a6aa26a612ebf91d05fabf350750d0d4fabd8954c0f1e9bbae94}{NO\_ERROR}};}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00050}00050 \}}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00051}00051 }
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00052}\mbox{\hyperlink{class_serial_interface_handler_abba67286134857f1ba7604b32db6f4d3}{00052}} \textcolor{comment}{/*static*/} \mbox{\hyperlink{class_message}{Message}} \mbox{\hyperlink{class_serial_interface_handler_abba67286134857f1ba7604b32db6f4d3}{SerialInterfaceHandler::ReadAndParseMessageBlocking}}(\textcolor{keywordtype}{int} *len)}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00053}00053 \{}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00054}00054     \textcolor{keywordflow}{if}(!len || *len == 0)}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00055}00055         \textcolor{keywordflow}{return} \mbox{\hyperlink{class_message}{Message}}(0, \mbox{\hyperlink{_commands_8h_a2afce0a47a93eee73a314d53e4890153a7e07130e0bea13162408021d61994021}{NOPE}});}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00056}00056 }
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00057}00057     \textcolor{keywordtype}{int} pos = 0;}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00058}00058     \textcolor{keywordtype}{char} tempData[\mbox{\hyperlink{_message_8h_a81f68567c11671e8c35cfcfb454a4160}{MAX\_COMMAND\_LEN}}];}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00059}00059     memset(tempData, 0x00, \mbox{\hyperlink{_message_8h_a81f68567c11671e8c35cfcfb454a4160}{MAX\_COMMAND\_LEN}});}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00060}00060 }
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00061}00061     \textcolor{comment}{// collect data until \(\backslash\)n}}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00062}00062     \textcolor{keywordtype}{int} lenToRead = *len;}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00063}00063     *len = 0;}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00064}00064     \textcolor{keywordflow}{do}}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00065}00065     \{}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00066}00066         *len += Serial.readBytes(\&tempData[pos], lenToRead);}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00067}00067         lenToRead =-\/ *len;}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00068}00068         pos += *len;}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00069}00069     \} \textcolor{keywordflow}{while}(!strstr(tempData, \textcolor{stringliteral}{"{}\(\backslash\)n"{}}) \&\& lenToRead > 0);}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00070}00070     Serial.write(tempData);}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00071}00071 }
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00072}00072 }
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00073}00073     \textcolor{keywordflow}{if}(*len == 0)}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00074}00074         \textcolor{keywordflow}{return} \mbox{\hyperlink{class_message}{Message}}(0, \mbox{\hyperlink{_commands_8h_a2afce0a47a93eee73a314d53e4890153a7e07130e0bea13162408021d61994021}{NOPE}});}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00075}00075 }
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00076}00076     \textcolor{keywordflow}{return} \mbox{\hyperlink{class_message_a2813a8d2312d3983fb932c8c1c8f31ce}{Message::CharArrayToMessage}}(tempData);}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00077}00077 \}}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00078}00078 }
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00079}\mbox{\hyperlink{class_serial_interface_handler_a3b2002503f5459a04c90af57699ead71}{00079}} \textcolor{comment}{/*static*/} \mbox{\hyperlink{class_message}{Message}} \mbox{\hyperlink{class_serial_interface_handler_a3b2002503f5459a04c90af57699ead71}{SerialInterfaceHandler::ReadAndParseMessageNonBlocking}}(\textcolor{keywordtype}{int} *len)}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00080}00080 \{}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00081}00081     \textcolor{keywordflow}{if}(!len || *len == 0)}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00082}00082         \textcolor{keywordflow}{return} \mbox{\hyperlink{class_message}{Message}}(0, \mbox{\hyperlink{_commands_8h_a2afce0a47a93eee73a314d53e4890153a7e07130e0bea13162408021d61994021}{NOPE}});}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00083}00083 }
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00084}00084 }
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00085}00085     \textcolor{keywordflow}{if}(\mbox{\hyperlink{class_serial_interface_handler_a49d8f1aebd456660b9278cebc90e9b68}{DataAvail}}() > 0)}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00086}00086         \textcolor{keywordflow}{return} \mbox{\hyperlink{class_serial_interface_handler_abba67286134857f1ba7604b32db6f4d3}{ReadAndParseMessageBlocking}}(len);}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00087}00087     \textcolor{keywordflow}{return} \mbox{\hyperlink{class_message}{Message}}(0, \mbox{\hyperlink{_commands_8h_a2afce0a47a93eee73a314d53e4890153a7e07130e0bea13162408021d61994021}{NOPE}});}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00088}00088 \}}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00089}00089 }
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00090}\mbox{\hyperlink{class_serial_interface_handler_a49d8f1aebd456660b9278cebc90e9b68}{00090}} \textcolor{comment}{/*static*/} \textcolor{keywordtype}{int} \mbox{\hyperlink{class_serial_interface_handler_a49d8f1aebd456660b9278cebc90e9b68}{SerialInterfaceHandler:: DataAvail}}()}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00091}00091 \{}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00092}00092     \textcolor{keywordflow}{return} Serial.available();}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00093}00093 \}}
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00094}00094 }
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00095}00095 }
\DoxyCodeLine{\Hypertarget{_serial_interface_handler_8cpp_source_l00096}00096 }

\end{DoxyCode}
